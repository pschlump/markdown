<!DOCTYPE html>
<!-- saved from url=(0080)https://blog.kowalczyk.info/article/cxn3/advanced-markdown-processing-in-go.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="referrer" content="always">
    <link rel="alternate" type="application/atom+xml" title="RSS 2.0" href="https://blog.kowalczyk.info/atom.xml">
    <link rel="canonical" href="https://blog.kowalczyk.info/article/cxn3/advanced-markdown-processing-in-go.html"> 
    <meta name="description" content="Advanced markdown processing in Go using gomarkdown/markdown"> 

    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@kjk">
    <meta name="twitter:title" content="Advanced markdown processing in Go"> 
    <meta name="twitter:description" content="Advanced markdown processing in Go using gomarkdown/markdown"> 
    <meta name="twitter:creator" content="@kjk"> 
    <meta name="twitter:image" content="https://blog.kowalczyk.info/img/cover-61.jpg">  
    <meta name="twitter:description" content="Advanced markdown processing in Go using gomarkdown/markdown"> 

    
    <meta property="og:title" content="Advanced markdown processing in Go">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://blog.kowalczyk.info/article/cxn3/advanced-markdown-processing-in-go.html"> 
    <meta property="og:description" content="Advanced markdown processing in Go using gomarkdown/markdown">  
    <meta property="og:image" content="https://blog.kowalczyk.info/img/cover-61.jpg"> 

    <title>Advanced markdown processing in Go</title>

    <link href="./Advanced-markdown-processing-in-Go_files/main.css" rel="stylesheet">
    <script type="text/javascript">
        function showcontact() {
            var el = document.getElementById("contact-form");
            el.style.display = "block";
            el = document.getElementById("contact-page-url");
            var uri = window.location.href;
            uri = uri.replace("#", "");
            el.value = uri;
            el = document.getElementById("msg-for-chris");
            el.focus();
        }
        function hidecontact() {
            var el = document.getElementById("contact-form");
            el.style.display = "none";
        }
        function isWindows() {
            return window.navigator &&
                window.navigator.platform &&
                window.navigator.platform.indexOf('Win') >= 0
        }
        function maybeShowAd() {
            
            

        }
        function onLoaded() {
            maybeShowAd();
        }
        document.addEventListener("DOMContentLoaded", onLoaded);
    </script>
    <script type="text/javascript">
        var galleries = {}; 
        function buildGalleriesInfo() {
            var els = document.getElementsByTagName("img");
            var n = els.length;
            for (var i = 0; i < n; i++) {
                var el = els[i];
                var id = el.id;
                if (!id.startsWith("id-thumb-img-")) {
                    continue
                }
                id = id.replace("id-thumb-img-", "")
                
                var parts = id.split("-");
                var galleryID = parseInt(parts[0]);
                var imageNo = parseInt(parts[1]);
                var galleryInfo = galleries[galleryID] || {};
                galleryInfo[imageNo] = el.src;
                galleries[galleryID] = galleryInfo;
            }
            var ids = Object.keys(galleries);
            for (var gid of ids) {
                var galleryInfo = galleries[gid];
                galleryInfo.nImages = Object.keys(galleryInfo).length;
                galleryInfo.currImageNo = 0;
                changeShot(gid, 0);
            }
        }

        function changeShot(galleryID, imgNo) {
            var gi = galleries[galleryID];
            gi.currImageNo = imgNo;
            var url = gi[imgNo];
            var id = "id-gallery-" + galleryID;
            var el = document.getElementById(id);
            el.src = url;
            
            for (var i = 0; i < gi.nImages; i++) {
                id = "id-thumb-" + galleryID + "-" + i;
                el = document.getElementById(id);
                if (i == imgNo) {
                    el.classList.add("selected-img");
                } else {
                    el.classList.remove("selected-img");
                }
            }
            var els = document.getElementsByTagName("div");
            var nEls = els.length;
        }

        function imgNext(galleryID) {
            var gi = galleries[galleryID];
            var nImages = gi.nImages;
            var imgNo = gi.currImageNo;
            imgNo = (imgNo + 1) % nImages;
            changeShot(galleryID, imgNo);
        }
        function imgPrev(galleryID) {
            var gi = galleries[galleryID];
            var imgNo = gi.currImageNo - 1;
            if (imgNo < 0) {
                imgNo = gi.nImages - 1;
            }
            changeShot(galleryID, imgNo);
        }
        document.addEventListener("DOMContentLoaded", buildGalleriesInfo);
    </script>

    <style>
        .tnav {
            margin-top: 0.5rem;
            align-items: baseline;
            flex-wrap: wrap;
            justify-content: space-around;
            column-gap: 4px;
            row-gap: 8px;
        }

        .title {
            font-size: 18pt;
            font-weight: bold;
        }

        .tagtop {
            font-size: 9pt;
            margin-left: 1em;
            color: #444444;
            background-color: #f3f3f3;
            padding: 4px 1em;
            padding-bottom: 6px;
        }

        .tagtop:hover {
            color: black;
            background-color: #e7e7e7;
            outline: 1px solid #d7d7d7;
        }

        .toc-toggle {
            font-size: 12px;
            right: 8px;
            top: 42px;
            padding: 4px 8px;
            border: 1px solid lightgray;
            background-color: white;
            color: gray;
            z-index: 10
        }
    </style>
    
</head>

<body>
    <div class="hdr flex z-10 sticky top-0 bg-white py-2">
  <div class="wrap flex items-center justify-between" style="column-gap: 0.5em;">
    

    
    <div style="width: 72px"></div>
    <div class="grow"></div>
    <a href="https://blog.kowalczyk.info/">Home</a>
    <div>•</div>
    <a href="https://blog.kowalczyk.info/software/">Software</a>
    <div>•</div>
    <a href="https://blog.kowalczyk.info/article/25a256f90ce44eb788390ecc3cf9cd65/writings.html">Writings</a>
    
    <div class="grow"></div>
    <a href="https://github.com/kjk" target="_blank">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="1em" height="1em" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5">
        </path>
      </svg>
    </a>
    <a href="https://twitter.com/kjk" target="_blank">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="1em" height="1em" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c0 -.249 1.51 -2.772 1.818 -4.013z">
        </path>
      </svg>
    </a>
    <a href="https://blog.kowalczyk.info/atom.xml">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rss" width="1em" height="1em" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <path d="M5 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"></path>
        <path d="M4 4a16 16 0 0 1 16 16"></path>
        <path d="M4 11a9 9 0 0 1 9 9"></path>
      </svg>
    </a>
  </div>
</div>

    

    
    <picture class="w-full">
        <source srcset=" data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" media="(max-width: 768px)">
        <img class="page-cover-image" src="./Advanced-markdown-processing-in-Go_files/cover-61.jpg">
    </picture>
    

    <div class="flex tnav wrap relative" style="margin-top: 12px">
        

        
        <div class="relative title ">
            <div>Advanced markdown processing in Go</div>

            
            <div class="absolute" style="right: -2.3em; top: 0px;">
                <a class="edit-link" href="https://github.com/kjk/blog/edit/master/server/www/md/2023-03-11-cxn3-advanced-markdown-processing-in-go.md" rel="nofollow" target="_blank">edit</a>
            </div>
            
        </div>

        

    </div>

    

    
    <div class="flex justify-center">
        
        <a href="https://blog.kowalczyk.info/tag/go" class="tagtop">go</a>
        
        <a href="https://blog.kowalczyk.info/tag/programming" class="tagtop">programming</a>
        
    </div>
    

    <div id="post" class="wrap">
        <div class="notion-page" id="cxn3">
<h1 class="hdr-with-anchor" id="using-gomarkdown-markdown-library"><div>Using gomarkdown/markdown library</div><a class="header-anchor" href="https://blog.kowalczyk.info/article/cxn3/advanced-markdown-processing-in-go.html#using-gomarkdown-markdown-library">
<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="header-anchor-widget-icon">
	<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
	<path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
</svg>
</a>
</h1>

<div>This article describes an advanced markdown processing in Go using <a target="_blank" href="https://github.com/gomarkdown/markdown">gomarkdown/markdown</a> library.</div>

<div>All the code examples are available at <a target="_blank" href="https://github.com/gomarkdown/markdown/tree/master/examples">https://github.com/gomarkdown/markdown/tree/master/examples</a></div>

<h1 class="hdr-with-anchor" id="basics-first"><div>Basics first</div><a class="header-anchor" href="https://blog.kowalczyk.info/article/cxn3/advanced-markdown-processing-in-go.html#basics-first">
<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="header-anchor-widget-icon">
	<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
	<path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
</svg>
</a>
</h1>

<div>Here’s a good start for markdown =&gt; HTML conversion:</div>
<div style="position: relative"><pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">mdToHTML</span><span class="p">(</span><span class="nx">md</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">[]</span><span class="kt">byte</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// create markdown parser with extensions
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">extensions</span> <span class="o">:=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">CommonExtensions</span> <span class="p">|</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">AutoHeadingIDs</span> <span class="p">|</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">NoEmptyLineBeforeBlock</span>
</span></span><span class="line"><span class="cl">	<span class="nx">p</span> <span class="o">:=</span> <span class="nx">parser</span><span class="p">.</span><span class="nf">NewWithExtensions</span><span class="p">(</span><span class="nx">extensions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">doc</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="nx">md</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// create HTML renderer with extensions
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">htmlFlags</span> <span class="o">:=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">CommonFlags</span> <span class="p">|</span> <span class="nx">html</span><span class="p">.</span><span class="nx">HrefTargetBlank</span>
</span></span><span class="line"><span class="cl">	<span class="nx">opts</span> <span class="o">:=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">RendererOptions</span><span class="p">{</span><span class="nx">Flags</span><span class="p">:</span> <span class="nx">htmlFlags</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">renderer</span> <span class="o">:=</span> <span class="nx">html</span><span class="p">.</span><span class="nf">NewRenderer</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">markdown</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre><a target="_blank" href="https://onlinetool.io/goplayground/#txO7hJ-ibeU" class="tryonline">
Try it online
</a>
</div>
<div>Basic markdown syntax is very limited and there are many extensions that provide additional feature, like tables.</div>

<div>HTML render is customizable as well.</div>

<div>Here we create markdown parser and HTML renderer with common flags plus some extensions.</div>

<div>Here are all available options for parser and HTML renderer:</div>

<ul>
<li><a target="_blank" href="https://pkg.go.dev/github.com/gomarkdown/markdown/parser#Extensions">https://pkg.go.dev/github.com/gomarkdown/markdown/parser#Extensions</a> : they change how parser interprets markdown</li>
<li><a target="_blank" href="https://pkg.go.dev/github.com/gomarkdown/markdown/html#Flags">https://pkg.go.dev/github.com/gomarkdown/markdown/html#Flags</a> : they change generated HTML</li>
</ul>

<h1 class="hdr-with-anchor" id="advanced-processing"><div>Advanced processing</div><a class="header-anchor" href="https://blog.kowalczyk.info/article/cxn3/advanced-markdown-processing-in-go.html#advanced-processing">
<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="header-anchor-widget-icon">
	<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
	<path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
</svg>
</a>
</h1>

<div>Markdown to HTML processing works like this:</div>

<ul>
<li><code>github.com/gomarkdown/markdown/parser</code> parses markdown and generates AST tree as defined in <code>github.com/gomarkdown/markdown/ast</code></li>
<li><code>github.com/gomarkdown/markdown/html</code> implements HTML renderer that takes AST tree and generates HTML</li>
</ul>

<div>There are options for even more control:</div>

<ul>
<li>customize HTML generator by providing <code>html.Renderer.RenderNodeHook</code>. You re-use most of the <code>html.Renderer</code> and change rendering of just some <code>ast.Node</code>.</li>
<li>fork <code>github.com/gomarkdown/markdown/html</code> and make changes you want to HTML renderer</li>
<li>modify ast tree after parsing but before rendering</li>
<li>customize the parser, define your own <code>ast.Node</code> types, add them to the tree while parsing and customize renderer to render those nodes as you want</li>
<li>pre-process markdown before sending to the parser</li>
</ul>

<h2 class="hdr-with-anchor" id="ast-node"><div><code>ast.Node</code></div><a class="header-anchor" href="https://blog.kowalczyk.info/article/cxn3/advanced-markdown-processing-in-go.html#ast-node">
<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="header-anchor-widget-icon">
	<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
	<path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
</svg>
</a>
</h2>

<div>You need to understand AST tree. Start by skimming <a target="_blank" href="https://github.com/gomarkdown/markdown/blob/master/ast/node.go">https://github.com/gomarkdown/markdown/blob/master/ast/node.go</a>.</div>

<div><code>ast.Node</code> is an interface so you can create your own nodes as long as you implement the interface.</div>

<div>The are two types of nodes:</div>

<ul>
<li>container node has an array of children nodes e.g. a <code>List</code> contains <code>ListItem</code> nodes</li>
<li>a leaf node doesn’t have children, just content</li>
</ul>

<div>We have <code>ast.Leaf</code> and <code>ast.Container</code> to make it easy to implement custom nodes:</div>
<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">MyCustomLeafNode</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ast</span><span class="p">.</span><span class="nx">Leaf</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// .. additional data for this node
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">MyCustomContainerNode</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ast</span><span class="p">.</span><span class="nx">Container</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// .. additional data for this node
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre>
<div>To render your custom node <code>ast.Node</code> to HTML you provide a render hook function that will be structured like this:</div>
<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">myRenderHook</span><span class="p">(</span><span class="nx">w</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// you must render custom nodes because html.Renderer doesn't understand them
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="nx">leafNode</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">node</span><span class="p">.(</span><span class="o">*</span><span class="nx">MyCustomLeafNode</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">renderMyLeafNode</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">lefNode</span><span class="p">,</span> <span class="nx">entering</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">GoToNext</span><span class="p">,</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">containerNode</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">node</span><span class="p">.(</span><span class="o">*</span><span class="nx">MyCustomContainerNode</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">renderMyContainerNode</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">containerNode</span><span class="p">,</span> <span class="nx">entering</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">GoToNext</span><span class="p">,</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// you can also over-ride rendering of some specific nodes that html.Renderer would render
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="nx">image</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">node</span><span class="p">.(</span><span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">Image</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">renderImage</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">image</span><span class="p">,</span> <span class="nx">entering</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">GoToNext</span><span class="p">,</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// return false to tell html.Renderer to use default render
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">GoToNext</span><span class="p">,</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre>
<div>You should always return <code>ast.GoToNext</code>.</div>

<div>You return <code>true</code> to indicate that you’ve rendered the node. Returning <code>false</code> tells <code>html.Renderer</code> to use default rendering.</div>

<div>For container nodes we typically need to render something before rendering children and after rendering children.</div>

<div>That’s why we need <code>entering</code> argument. The simplest rendering of <code>*ast.Paragraph</code> would be:</div>
<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">myRenderParagraph</span><span class="p">(</span><span class="nx">w</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">,</span> <span class="nx">p</span> <span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">Paragraph</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">entering</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">io</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">"&lt;p&gt;"</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">io</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">"&lt;/p&gt;"</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre>
<div><code>html.Renderer</code> takes care of recursively rendering children.</div>

<div>For <code>ast.Leaf</code> nodes you only render on entering:</div>
<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">myHr</span><span class="p">(</span><span class="nx">w</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">,</span> <span class="nx">p</span> <span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">HorizontalRule</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">entering</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">io</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">"&lt;hr/&gt;"</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre>
<div>Skim <a target="_blank" href="https://github.com/gomarkdown/markdown/blob/master/html/renderer.go">render.go</a> to see how different nodes are rendered to HTML.</div>

<h2 class="hdr-with-anchor" id="customizing-html-renderer"><div>Customizing HTML renderer</div><a class="header-anchor" href="https://blog.kowalczyk.info/article/cxn3/advanced-markdown-processing-in-go.html#customizing-html-renderer">
<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="header-anchor-widget-icon">
	<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
	<path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
</svg>
</a>
</h2>

<div>To re-use most of <code>html.Renderer</code> but only over-ride rendering of a few nodes, you can provide a render hook.</div>

<div>Here’s an example of a simple hook that renders <code>&lt;div&gt;{children}&lt;/div&gt;</code> instead of <code>&lt;p&gt;{children}&lt;/p&gt;</code> for a <code>*ast.Paragraph</code> node.</div>
<div style="position: relative"><pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="c1">// an actual rendering of Paragraph is more complicated
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">renderParagraph</span><span class="p">(</span><span class="nx">w</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">,</span> <span class="nx">p</span> <span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">Paragraph</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">entering</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">io</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">"&lt;div&gt;"</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">io</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">"&lt;/div&gt;"</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">myRenderHook</span><span class="p">(</span><span class="nx">w</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">para</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">node</span><span class="p">.(</span><span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">Paragraph</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">renderParagraph</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">para</span><span class="p">,</span> <span class="nx">entering</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">GoToNext</span><span class="p">,</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">GoToNext</span><span class="p">,</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">newCustomizedRender</span><span class="p">()</span> <span class="o">*</span><span class="nx">html</span><span class="p">.</span><span class="nx">Renderer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">opts</span> <span class="o">:=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">RendererOptions</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">RenderNodeHook</span><span class="p">:</span> <span class="nx">myRenderHook</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">html</span><span class="p">.</span><span class="nf">NewRenderer</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre><a target="_blank" href="https://onlinetool.io/goplayground/#yFRIWRiu-KL" class="tryonline">
Try it online
</a>
</div>
<div>If a render hook needs access to more information than <code>io.Writer</code> and  <code>ast.Node</code>, we can capture it in a closure:</div>
<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="s">"github.com/gomarkdown/markdown/html"</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">renderData</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ... data needed for render hook function
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">makeRenderHook</span><span class="p">(</span><span class="nx">data</span> <span class="o">*</span><span class="nx">renderData</span><span class="p">)</span>  <span class="nx">html</span><span class="p">.</span><span class="nx">RenderNodeFunc</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nf">myRenderHook</span><span class="p">(</span><span class="nx">w</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// has access to data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">newCustomizedRender</span><span class="p">()</span> <span class="o">*</span><span class="nx">html</span><span class="p">.</span><span class="nx">Renderer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">data</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">renderData</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">opts</span> <span class="o">:=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">RendererOptions</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">RenderNodeHook</span><span class="p">:</span> <span class="nf">makeRenderHook</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">html</span><span class="p">.</span><span class="nf">NewRenderer</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre>
<h2 class="hdr-with-anchor" id="modify-ast-tree"><div>Modify ast tree</div><a class="header-anchor" href="https://blog.kowalczyk.info/article/cxn3/advanced-markdown-processing-in-go.html#modify-ast-tree">
<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="header-anchor-widget-icon">
	<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
	<path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
</svg>
</a>
</h2>

<div>The structure of the code would be:</div>
<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">modifyAst</span><span class="p">(</span><span class="nx">root</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">)</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ... tweak AST tree as needed
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="nx">root</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">mds</span> <span class="p">=</span> <span class="s">`[link](http://example.com)`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">modifyAstExample</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">md</span> <span class="o">:=</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">mds</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">extensions</span> <span class="o">:=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">CommonExtensions</span>
</span></span><span class="line"><span class="cl">	<span class="nx">p</span> <span class="o">:=</span> <span class="nx">parser</span><span class="p">.</span><span class="nf">NewWithExtensions</span><span class="p">(</span><span class="nx">extensions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">doc</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="nx">md</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">doc</span> <span class="p">=</span> <span class="nf">modifyAst</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">htmlFlags</span> <span class="o">:=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">CommonFlags</span>
</span></span><span class="line"><span class="cl">	<span class="nx">opts</span> <span class="o">:=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">RendererOptions</span><span class="p">{</span><span class="nx">Flags</span><span class="p">:</span> <span class="nx">htmlFlags</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">renderer</span> <span class="o">:=</span> <span class="nx">html</span><span class="p">.</span><span class="nf">NewRenderer</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">html</span> <span class="o">:=</span> <span class="nx">markdown</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">"-- Markdown:\n%s\n\n--- HTML:\n%s\n"</span><span class="p">,</span> <span class="nx">md</span><span class="p">,</span> <span class="nx">html</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre>
<div>You can re-arrange the tree: add, remove, rearrange nodes or add / remove information from nodes.</div>

<div>Working with trees is tricky so you’ll probably use <code>ast.Print(io.Writer, ast.Node)</code> to pretty-print and understand AST tree, both before and after making changes.</div>

<div>I won’t cover changing the structure of the tree but here’s an example that adds <code>target="_blank"</code> attribute to link (<code>&lt;a&gt;</code>) nodes that go outside of my website and adds custom <code>blog-img</code> class to all image (<code>&lt;img&gt;</code>) nodes.</div>
<div style="position: relative"><pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">modifyAst</span><span class="p">(</span><span class="nx">doc</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">)</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ast</span><span class="p">.</span><span class="nf">WalkFunc</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">img</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">node</span><span class="p">.(</span><span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">Image</span><span class="p">);</span> <span class="nx">ok</span> <span class="o">&amp;&amp;</span> <span class="nx">entering</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">attr</span> <span class="o">:=</span> <span class="nx">img</span><span class="p">.</span><span class="nx">Attribute</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="nx">attr</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">attr</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">ast</span><span class="p">.</span><span class="nx">Attribute</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// TODO: might be duplicate
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">attr</span><span class="p">.</span><span class="nx">Classes</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">attr</span><span class="p">.</span><span class="nx">Classes</span><span class="p">,</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">"blog-img"</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span class="nx">Attribute</span> <span class="p">=</span> <span class="nx">attr</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">link</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">node</span><span class="p">.(</span><span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">Link</span><span class="p">);</span> <span class="nx">ok</span> <span class="o">&amp;&amp;</span> <span class="nx">entering</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">isExternalURI</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">uri</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">HasPrefix</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span> <span class="s">"https://"</span><span class="p">)</span> <span class="o">||</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">HasPrefix</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span> <span class="s">"http://"</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">!</span><span class="nx">strings</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span> <span class="s">"blog.kowalczyk.info"</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="nf">isExternalURI</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">link</span><span class="p">.</span><span class="nx">Destination</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">link</span><span class="p">.</span><span class="nx">AdditionalAttributes</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">link</span><span class="p">.</span><span class="nx">AdditionalAttributes</span><span class="p">,</span> <span class="s">`target="_blank"`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">GoToNext</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">doc</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre><a target="_blank" href="https://onlinetool.io/goplayground/#2yV5-HDKBUV" class="tryonline">
Try it online
</a>
</div>
<div>Important parts:</div>

<ul>
<li><code>ast.WalkFunc</code> is a helper function that recursively calls a callback function on every node in AST</li>
<li>we do modifications only once e.g. when <code>entering</code> is true</li>
<li>all <code>Container</code> nodes have (optional) <code>*Attribute</code> which contains HTML id attribute, class names and attributes, which we can modify</li>
<li>some nodes can have additional data we can modify e.g. <code>*ast.Link</code> has <code>AdditionalAttributes</code> which is array of attributes.</li>
</ul>
<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Attribute</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ID</span>      <span class="p">[]</span><span class="kt">byte</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Classes</span> <span class="p">[][]</span><span class="kt">byte</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Attrs</span>   <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">][]</span><span class="kt">byte</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre>
<h2 class="hdr-with-anchor" id="custom-markdown-parser-custom-ast-node"><div>Custom markdown parser, custom <code>ast.Node</code></div><a class="header-anchor" href="https://blog.kowalczyk.info/article/cxn3/advanced-markdown-processing-in-go.html#custom-markdown-parser-custom-ast-node">
<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="header-anchor-widget-icon">
	<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
	<path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
</svg>
</a>
</h2>

<div>You can also extend parser to recognize additional syntax, not present in markdown.</div>

<div>Here’s an example of a parser extension that recognizes the following:</div>
<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl">:gallery
</span></span><span class="line"><span class="cl">/img/image-1.png
</span></span><span class="line"><span class="cl">/img/image-2.png
</span></span><span class="line"><span class="cl">/img/image-3.png
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Rest of document.
</span></span></code></pre>
<div>A gallery is a list of image urls. In generated HTML this will be a show as an image gallery.</div>

<div>First define a custom leaf node type:</div>
<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Gallery</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ast</span><span class="p">.</span><span class="nx">Leaf</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ImageURLS</span> <span class="p">[]</span><span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre>
<div>Then customize parser with a block parsing hook function which gets first dibs at parsing block text.</div>

<div>Block means: it only gets called at the beginning of each text block. Text blocks are separated by newlines.</div>

<div>It’s not possible to do custom inline text parsing.</div>

<div>If parser hook function recognizes its custom syntax, it returns <code>ast.Node</code> it generated (<code>Gallery</code> in this case), number of bytes consumed and inner content to be recursively parsed and inserted as children of <code>ast.Container</code> node.</div>

<div>Number of bytes consumed allows parser to skip the part parsed by your custom hook.</div>
<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">parserHook</span><span class="p">(</span><span class="nx">data</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">n</span> <span class="o">:=</span> <span class="nf">parseGallery</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span> <span class="nx">node</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">n</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">newMarkdownParser</span><span class="p">()</span> <span class="o">*</span><span class="nx">parser</span><span class="p">.</span><span class="nx">Parser</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">extensions</span> <span class="o">:=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">CommonExtensions</span>
</span></span><span class="line"><span class="cl">	<span class="nx">p</span> <span class="o">:=</span> <span class="nx">parser</span><span class="p">.</span><span class="nf">NewWithExtensions</span><span class="p">(</span><span class="nx">extensions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">p</span><span class="p">.</span><span class="nx">Opts</span><span class="p">.</span><span class="nx">ParserHook</span> <span class="p">=</span> <span class="nx">parserHook</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">p</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre>
<div>Here’s the parser for <code>:gallery</code> syntax.</div>

<div>If current text starts with <code>:gallery\n</code> we expect a list of urls followed by an empty line.</div>
<div style="position: relative"><pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">gallery</span> <span class="p">=</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">":gallery\n"</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">parseGallery</span><span class="p">(</span><span class="nx">data</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">!</span><span class="nx">bytes</span><span class="p">.</span><span class="nf">HasPrefix</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">gallery</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">i</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">gallery</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// find empty line that ends the block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// TODO: should also consider end of document
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">end</span> <span class="o">:=</span> <span class="nx">bytes</span><span class="p">.</span><span class="nf">Index</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">:],</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">"\n\n"</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">end</span> <span class="p">&lt;</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">end</span> <span class="p">=</span> <span class="nx">end</span> <span class="o">+</span> <span class="nx">i</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// split into lines, each line is an image URL
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">lines</span> <span class="o">:=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">:</span><span class="nx">end</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="nx">parts</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="nx">lines</span><span class="p">,</span> <span class="s">"\n"</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">res</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Gallery</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ImageURLS</span><span class="p">:</span> <span class="nx">parts</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">res</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">end</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre><a target="_blank" href="https://onlinetool.io/goplayground/#9fqKwRbuJ04" class="tryonline">
Try it online
</a>
</div>
<div>I will not cover how it gets rendered as HTML because it’s a very custom solution with lots of HTML obscuring the big picture.</div>

<h2 class="hdr-with-anchor" id="syntax-highlighting"><div>Syntax highlighting</div><a class="header-anchor" href="https://blog.kowalczyk.info/article/cxn3/advanced-markdown-processing-in-go.html#syntax-highlighting">
<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="header-anchor-widget-icon">
	<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
	<path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
</svg>
</a>
</h2>

<div>Code blocks are much better with syntax highlighting.</div>

<div>We can use <a target="_blank" href="https://github.com/alecthomas/chroma">github.com/alecthomas/chroma</a> library to generate HTML with syntax highlighting for many languages.</div>

<div>We hook it up to HTML renderer with render hook function like described above.</div>
<div style="position: relative"><pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">"fmt"</span>
</span></span><span class="line"><span class="cl">	<span class="s">"io"</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">"github.com/gomarkdown/markdown"</span>
</span></span><span class="line"><span class="cl">	<span class="s">"github.com/gomarkdown/markdown/ast"</span>
</span></span><span class="line"><span class="cl">	<span class="nx">mdhtml</span> <span class="s">"github.com/gomarkdown/markdown/html"</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">"github.com/alecthomas/chroma"</span>
</span></span><span class="line"><span class="cl">	<span class="s">"github.com/alecthomas/chroma/formatters/html"</span>
</span></span><span class="line"><span class="cl">	<span class="s">"github.com/alecthomas/chroma/lexers"</span>
</span></span><span class="line"><span class="cl">	<span class="s">"github.com/alecthomas/chroma/styles"</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="nx">htmlFormatter</span>  <span class="o">*</span><span class="nx">html</span><span class="p">.</span><span class="nx">Formatter</span>
</span></span><span class="line"><span class="cl">	<span class="nx">highlightStyle</span> <span class="o">*</span><span class="nx">chroma</span><span class="p">.</span><span class="nx">Style</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">htmlFormatter</span> <span class="p">=</span> <span class="nx">html</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">html</span><span class="p">.</span><span class="nf">WithClasses</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span> <span class="nx">html</span><span class="p">.</span><span class="nf">TabWidth</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">htmlFormatter</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="s">"couldn't create html formatter"</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">styleName</span> <span class="o">:=</span> <span class="s">"monokailight"</span>
</span></span><span class="line"><span class="cl">	<span class="nx">highlightStyle</span> <span class="p">=</span> <span class="nx">styles</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">styleName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">highlightStyle</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">"didn't find style '%s'"</span><span class="p">,</span> <span class="nx">styleName</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// based on https://github.com/alecthomas/chroma/blob/master/quick/quick.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">htmlHighlight</span><span class="p">(</span><span class="nx">w</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">,</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">lang</span><span class="p">,</span> <span class="nx">defaultLang</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">lang</span> <span class="o">==</span> <span class="s">""</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">lang</span> <span class="p">=</span> <span class="nx">defaultLang</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">l</span> <span class="o">:=</span> <span class="nx">lexers</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">lang</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">l</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">l</span> <span class="p">=</span> <span class="nx">lexers</span><span class="p">.</span><span class="nf">Analyse</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">l</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">l</span> <span class="p">=</span> <span class="nx">lexers</span><span class="p">.</span><span class="nx">Fallback</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">l</span> <span class="p">=</span> <span class="nx">chroma</span><span class="p">.</span><span class="nf">Coalesce</span><span class="p">(</span><span class="nx">l</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">it</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">l</span><span class="p">.</span><span class="nf">Tokenise</span><span class="p">(</span><span class="kc">nil</span><span class="p">,</span> <span class="nx">source</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">htmlFormatter</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">highlightStyle</span><span class="p">,</span> <span class="nx">it</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// an actual rendering of Paragraph is more complicated
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">renderCode</span><span class="p">(</span><span class="nx">w</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">,</span> <span class="nx">codeBlock</span> <span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">CodeBlock</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">defaultLang</span> <span class="o">:=</span> <span class="s">""</span>
</span></span><span class="line"><span class="cl">	<span class="nx">lang</span> <span class="o">:=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">codeBlock</span><span class="p">.</span><span class="nx">Info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nf">htmlHighlight</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">codeBlock</span><span class="p">.</span><span class="nx">Literal</span><span class="p">),</span> <span class="nx">lang</span><span class="p">,</span> <span class="nx">defaultLang</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">myRenderHook</span><span class="p">(</span><span class="nx">w</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span> <span class="nx">entering</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">WalkStatus</span><span class="p">,</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">node</span><span class="p">.(</span><span class="o">*</span><span class="nx">ast</span><span class="p">.</span><span class="nx">CodeBlock</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nf">renderCode</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">entering</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">GoToNext</span><span class="p">,</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">GoToNext</span><span class="p">,</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre><a target="_blank" href="https://onlinetool.io/goplayground/#Bk0zTvrzUDR" class="tryonline">
Try it online
</a>
</div>
<div>You’ll have to include chroma CSS as HTML generation marks up nodes with chroma CSS classes.</div>

<h2 class="hdr-with-anchor" id="pre-process-markdown-before-parsing"><div>Pre-process markdown before parsing</div><a class="header-anchor" href="https://blog.kowalczyk.info/article/cxn3/advanced-markdown-processing-in-go.html#pre-process-markdown-before-parsing">
<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="header-anchor-widget-icon">
	<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
	<path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
</svg>
</a>
</h2>

<div>Imagine you want to add ability to include markdown files.</div>

<div>You can build a parser extension that e.g. recognizes this syntax:</div>
<pre tabindex="0" class="chroma"><code><span class="line"><span class="cl">@include "foo/bar.md"
</span></span></code></pre>
<div>It’ll get complicated if you want to add more advanced functionality, like loops, variables etc.</div>

<div>But <a target="_blank" href="https://pkg.go.dev/text/template"><code>template/text</code></a> library already implement such features.</div>

<div>You can pre-process markdown with one of the many templating Go libraries before sending it to the parser.</div>

</div>


        <div class="article-meta">
            <div>
                
                
                Written on Mar 11 2023.
                
                Topics: <a href="https://blog.kowalczyk.info/tag/go" class="taglink">go</a>, <a href="https://blog.kowalczyk.info/tag/programming" class="taglink">programming</a>.
                
                
                
            </div>
            <div>
                
                
                <a href="https://blog.kowalczyk.info/">home</a>
                
                
            </div>
            <div>
                Found a mistake, have a comment?
                <a href="https://blog.kowalczyk.info/article/cxn3/advanced-markdown-processing-in-go.html#" onclick="showcontact(); return false;">Let me know</a>.
            </div>
        </div>

        <form name="blog-article-feedback" netlify="" id="contact-form">
            <p>
            </p><div class="contact-light">Feedback about page:</div>
            <input type="text" name="page-url" id="contact-page-url" readonly="">
            <p></p>
            <p>
            </p><div class="contact-light">Feedback:</div>
            <textarea name="message" id="msg-for-chris"></textarea>
            <div class="contact-light">Optional: your email if you want me to get back to you: </div>
            <input type="email" name="email">
            <p></p>
            <p>
                <button type="submit" class="contact-btn">
                    Send Feedback
                </button>
                <button class="contact-btn" style="float: right;" onclick="hidecontact(); return false;">
                    Cancel
                </button>
            </p>
        </form>

        <p></p>
    </div>



</body></html>